<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>One Pager for:</title>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
</head>
<body style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<h2>One Pager: JMSRA changes to allow Broker database properties to be configured<br></h2>

<p><u>Note that this one-pager has been withdrawn.</u></p>

(template version: 1.91)<br>
<table border="1" cellpadding="2" width="756">
  <tbody>
    <tr>
      <td>
      <p><b>Table of Contents</b><br>
      <a href="#1">1. Introduction</a><br>
      </p>
      <blockquote> <a href="#11">1.1 Project/Component Working Name</a><br>
        <a href="#12">1.2 Name(s) and e-mail address of Document
Author(s)/Supplier</a><br>
        <a href="#13">1.3. Date of This Document</a><br>
      </blockquote>
      <a href="#2">2. Project Summary</a><br>
      <blockquote> <a href="#21">2.1 Project Description</a><br>
        <a href="#22">2.2 Risks and Assumptions</a><br>
      </blockquote>
      <a href="#3">3. Problem Summary</a><br>
      <blockquote>
        <a href="#31">3.1 Problem Area</a><br>
        <a href="#32">3.2 Justification</a><br>
      </blockquote>
      <a href="#4">4. Technical Description</a><br>
      <blockquote>
        <p><a href="#41">4.1 Details</a><br>
        <a href="#42">4.2 Bugs/RFE's</a><br>
        <a href="#43">4.3 Scope</a><br>
        <a href="#44">4.4 Out-of-scope</a><br>
        <a href="#45">4.5 Interfaces</a><br>
        <a href="#46">4.6 Documentation Impact</a><br>
        <a href="#47">4.7 Configuration/administration Impact</a><br>
        <a href="#48">4.8 High Availability Impact</a><br>
        <a href="#49">4.9 Internationalization</a><br>
        <a href="#410">4.10 Packaging</a><br>
        <a href="#411">4.11 Security Impact</a><br>
        <a href="#412">4.12 Compatibility</a><br>
        <a href="#413">4.13 Dependencies</a><br>
        <a href="#414">4.14 Testing Impact</a></p>
      </blockquote>
      <p><a href="#5">5. References</a><br>
      <a href="#6">6. Schedule </a> <br>
      </p>
      <p><br>
      </p>
      <h3><a name="1"></a>1. Introduction<br>
      </h3>
      <p><a name="11"></a><b>1.1. Project/Component Working Name</b></p>
      <p>JMSRA changes to allow Broker database properties to be configured<br>
      </p>
      <p><a name="12"></a><b>1.2. Name(s) and e-mail address of
Document
Author(s)/Supplier</b></p>
      <p>Nigel Deakin<br>
nigel.deakin@oracle.com</p>
      <p><a name="13"></a><b>1.3. Date of This Document</b></p>
      <p>15 June 2010</p>
      <h3><a name="2"></a>2. Project Summary</h3>
      <p><br>
      <a name="21"></a><b>2.1. Project Description</b></p>
      <p>This project relates to the use of JMSRA (the MQ resource adapter used by default by Glassfish)
      to "manage" a local or embedded MQ broker. JMSRA currently provides a number of methods to allow
      a HADB database to be configured for use by the broker for message storage.
      This project proposes to deprecate those methods and provide in their place a new method 
	  <tt>setBrokerDBProps()</tt> on the JMSRA classes 
      <tt>com.sun.messaging.jms.blc.LifecycleManagedBroker</tt> and <tt>com.sun.messaging.jms.ra.ResourceAdapter</tt> to 
      which can allow any kind of database,
      not just HADB, to be configured.</p>
      <p><a name="22"></a><b>2.2. Risks and Assumptions</b></p>
      <p>This change is low risk and makes no particular assumptions</p>
      <h3><a name="3"></a>3. Problem Summary</h3>
      <p><a name="31"></a><b>3.1. Problem Area</b></p>
      <p>This project is needed to allow Glassfish to configure a managed MQ broker which uses a database other than HADB for message storage.
      Currently only a HADB is supported. </p>
      <p><a name="32"></a><b>3.2. Justification</b></p>
      <p>This project is needed because Glassfish 3.1/MQ 4.5 will not support HADB, and so needs to be able to use databases such as MySQL and Oracle Database for message storage.</p>
      <h3><a name="4"></a>4. Technical Description</h3>
      <p><a name="41"></a><b>4.1. Details</b></p>
      <p>
      This project proposes to add a new method 
	  <tt>setBrokerDBProps()</tt> to the JMSRA classes 
      <tt>com.sun.messaging.jms.blc.LifecycleManagedBroker</tt> and <tt>com.sun.messaging.jms.ra.ResourceAdapter</tt> to 
      which can allow any database-rekated property (including passwords) to be passed to the managed MQ broker 
      and so allow any type of database supported by MQ to be configured.      
      For more information see <a href="#45">interfaces</a> below.     
      </p>
      <p> <a name="42"></a><b>4.2. Bug/RFE Number(s)</b></p>
      <p>
N/A

      <p> <a name="43"></a><b>4.3. In Scope</b></p>
      <p>This project covers changes to JMSRA, the MQ resource adapter. It also covers changes to the MQ broker if any are needed.</p>
      <p> <a name="44"></a><b>4.4. Out of Scope</b></p>
      <p>This project does not include the necessary changes to Glassfish to allow users to make use of this new feature.</p>
      <p> <a name="45"></a><b>4.5. Interfaces</b></p>

      <p> <b>4.5.1 Public Interfaces</b></p>
      <p>The following new method will be added to <tt>com.sun.messaging.jms.ra.ResourceAdapter</tt>.
      The same method will also be added to <tt>com.sun.messaging.jms.blc.LifecycleManagedBroker</tt> in order
      to allow the future separation of broker lifecycle management functionality from the resource adapter.</p>
      <table border="1" width="80%">
        <tbody>
          <tr>
            <td width="40%"><tt>setBrokerDBProps(Properties props)</td>
            <td width="60%">Specifies a set of database-related properties which will be passed to the managed broker.<br><br>
            Any broker property starting with <tt>imq.persist.jdbc</tt> can be specified using this method. <br><br>
            This method can be used to specify a database password. Properties of the form <tt>imq.persist.jdbc.*.password</tt> will be intercepted
            and passed securely to managed broker. <br><br>
            Values of properties defined using this method will override any values defined using the methods <tt>setDSProps()</tt>
            and <tt>setDBProps()</tt>, which will be deprecated.</td>
          </tr>
          <tr>
            <td width="40%"><tt>getBrokerDBProps()</td>
            <td width="60%">Returns the <tt>Properties</tt> object passed in a previous call to </tt>setBrokerDBProps()</tt></td>
          </tr> 
        </tbody>
      </table>
      <p>
      <b>4.5.2 Private interfaces</b></p>
      <p>None</p>
      <p> <b>4.5.3 Deprecated/Removed Interfaces</b></p>
      <p>The following existing methods on <tt>com.sun.messaging.jms.ra.ResourceAdapter</tt> and
      <tt>com.sun.messaging.jms.blc.LifecycleManagedBroker</tt> will be deprecated by this project.
      </p>
      <table border="1" width="80%">
        <tbody>
          <tr>
            <td width="40%"><tt>setDSProps(properties props)</tt></td>
            <td width="60%">This method is deprecated because it required users to set special JMSRA-specific properties which
            would then be converted to broker properties. It also required <tt>setDSProps()</tt> to be used for some properties
            and <tt>setDBProps()</tt> to be used for other properties, which was confusing.
            <br><br>Only HADB-specific properties were supported,
            though recent changes to MQ 4.5 to allow the full range of passwords to be passed securely to a managed MQ broker 
            described in this <a href="https<br/<br>://mq.java.net/4.5-content/6897519OnePager.html">one-pager</a>)
            extended this to support MySQL. After further review it has been decided that this method is insufficently generic
            and so needs to be replaced by the method <tt>setBrokerDBProps()</tt> should be used instead.</td>
          </tr>
          <tr>
            <td width="40%"><tt>setDBProps(properties props)</tt></td>
            <td width="60%">Same reasons as above.</td>
          </tr>
          <tr>
            <td width="40%"><tt>getDSProps()</tt></td>
            <td width="60%">Same reasons as above.</td>
          </tr>
          <tr>
            <td width="40%"><tt>getDBProps()</tt></td>
            <td width="60%">Same reasons as above.</td>
          </tr>
        </tbody>
      </table>
      <p> <a name="46"></a><b>4.6. Doc Impact</b></p>
      <p>In the MQ administration guide, the table of ResourceAdapter properties will need to be updated.</p>
      <p> <a name="47"></a><b>4.7. Admin/Config Impact</b></p>
      <p>Although the purpose of this project is to allow Glassfish users to configure the use of any supported database with a managed broker, 
      the changes to Glassfish are our of scope and are not described here.</p>
      <p> <a name="48"></a><b>4.8. HA Impact</b></p>
      <p>This change is specifically intended to support HA by allow users to configure a enhanced cluster of MQ brokers
      which store their messages in a shared HA database.</p>
      <p> <a name="49"></a><b>4.9. I18N/L10N Impact</b>inks</p>
      <p>This change has no internationalisation or globalisation impact.</p>
      <p> <a name="410"></a><b>4.10. Packaging, Delivery &amp; Upgrade</b></p>
      <p> <b>4.10.1 Packaging</b></p>
      <p>This project has no impact on packaging.</p>
      <p> <b>4.10.2 Delivery</b></p>
      <p>This project has no impact on product installation.</p>
      <p> <b>4.10.3 Upgrade and Migration</b></p>
      <p>This project has no impact in compatibility. </p>
      <p> <a name="411"></a><b>4.11. Security Impact</b></p>
      <p>This project has no security implications with the following exception:
      Any database passwords supplied using this new API will be transmitted securely to the managed broker
      as described in this <a href="https<br/<br>://mq.java.net/4.5-content/6897519OnePager.html">one-pager</a>
       </p>
      <p> <a name="412"></a><b>4.12. Compatibility Impact</b></p>
      <p> This project has no implications for compatibility. Older interfaces will continue to be supported, though they will be deprecated as listed above. </p>
      <p> <a name="413"></a><b>4.13. Dependencies</b></p>
      <p> <b>4.13.1 Internal Dependencies</b></p>
      <p>This project has no internal dependencies on other software.
      Note, however, that changes are needed to Glassfish before the changes defined in this project can be made available to Glassfish users.
      Those changes are out of scope of this one-pager.</p>
      <p>This project has no external dependencies on other software.</p>
      <p> <a name="414"></a><b>4.14. Testing Impact</b></p>
      <p>This work will be tested using automatic MQ regression tests.</p>
      <h3><a name="5"></a>5. Reference Documents</h3>
      <p>N/A
      </p>
      <h3><a name="6"></a>6. Schedule</h3>
      <p><b>6.1. Projected Availability</b></p>
      <p>It is currently planned that this change will be released in MQ 4.5 Milestone 3.
      <p>&nbsp;</p>
      </td>
    </tr>
  </tbody>
</table>
</body>
</html>
